<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>geekchat</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="/jquery.js"></script>
        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->

        <!-- Add your site or application content here -->
        <p>chat here</p>
        <a href="/auth/github">Login github</a>
        <input type="text" id="roomname" name="room.name"/>
        <button onclick="createRoom()">create</button>
        <script src="/engine.io.js"></script>
        <input type="text" id="roomId" name="roomid"/>
        <button onclick="joinRoom()">join</button>
        <textarea id="chat" placeholder="typein"></textarea>
        <button onclick="sendMsg()">submit</button>
        <script>
          var inRoom = null;
          
          function sendMsg(){
            socket.send(str({t:'msg', r:inRoom, m: $('#chat').val()}))
          }
          
          function createRoom(){
            $.ajax({
              type:"POST",
              url:"/api/rooms",
              data:{name: $('#roomname').val()}
            }).done(function(data){
              console.log(data);
            });
          }
          var socket = new eio.Socket('ws://localhost:8080/');
          function js(data){
            return JSON.parse(data);
          }
          function str(data){
            return JSON.stringify(data);
          }
          
          function joinRoom(){
            socket.send(str({t:'sys', r: $('#roomId').val(), m:"joinRoom"}));
            inRoom = $('#roomId').val();
          }

          socket.on('open', function () {
            $.ajax({
              url:"/api/me"
            }).done(function(data){
              socket.send(str({t:'authorization', user: data}));
            });
   

            socket.on('message', function (data) { 
              console.log(data);
            });
            socket.on('close', function () { });
            }); 
        </script>
        <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
        <script>
            (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
            function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
            e=o.createElement(i);r=o.getElementsByTagName(i)[0];
            e.src='//www.google-analytics.com/analytics.js';
            r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
            ga('create','UA-XXXXX-X');ga('send','pageview');
        </script>
    </body>
</html>
